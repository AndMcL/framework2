{% extends '@content/page.twig' %}

{% import '@util/formmacro.twig' as f %}

{% block header %}
    <section class="col-md-12 mt-5">
        <h1>Test FormData calls for {{op}}</h1>
    </section>
{% endblock header %}

{% block onload %}
    {% if op == 'put' %}
        {% set op = 'get' %}
        document.getElementById('tform').addEventListener('submit', function(e) {
            e.preventDefault();
            e.stopPropagation();
            var request = new XMLHttpRequest();
            request.open(putorpatch, '#', true);
            request.setRequestHeader('Content-Type', 'multipart/form-data; charset=UTF-8');
            data = new FormData;
            e.target.querySelectorAll('input[type="text"]').forEach(function(el){
               data.append(el.getAttribute('name'), el.value);
            });
            request.onreadystatechange = function() {
                if (this.readyState == 4)
                {
                    document.getElementsByTagName('html')[0].innerHTML = this.responseText;
                }
            };
            request.send(data);
            return false;
        });
    {% endif %}
    {% if op == 'cookie' %}
        document.cookie = 'exist=42';
        document.cookie = 'aexist[]=42';
        document.cookie = 'aexist[]=42';
        document.cookie = 'nexist[14]=42';
        document.cookie = 'nexist[15]=42';
        document.cookie = 'kexist[key1]=42';
        document.cookie = 'kexist[key2]=42';
    {% endif %}
{% endblock onload %}

{% block main %}
    <section class="row">
        <article class="ml-auto col-md-10">
            {% include '@util/message.twig' %}
            <pre>{{array}}</pre>
            {{f.startform({method: op, id: 'tform'})}}
                {% if op != 'cookie' %}
                    {{f.text({label: 'Simple', name: 'exist', value: 42})}}
                    {{f.text({label: 'Array', name: 'aexist[]', value: 42})}}
                    {{f.text({label: 'Array', name: 'aexist[]', value: 42})}}
                    {{f.text({label: 'Array', name: 'nexist[14]', value: 42})}}
                    {{f.text({label: 'Array', name: 'nexist[15]', value: 42})}}
                    {{f.text({label: 'Array', name: 'kexist[key1]', value: 42})}}
                    {{f.text({label: 'Array', name: 'kexist[key2]', value: 42})}}
                {% endif %}
                {{f.submit({value: 'Test'})}}
            {{f.endform()}}
    </article>
    </section>
{% endblock main %}

{% block pagefooter %}
{% endblock pagefooter %}
